YII-TREEMP ([English version](https://github.com/wartur/yii-treemp/blob/master/README.md))
==========================================================================================

Расширение для Yii для работы c деревом с помощью алгоритма материализованного пути.
При использовании данного расширения не забывайте пользоваться транзакциями или блокировками таблиц.

ДЕМО: http://yii-treemp.wartur.ru

## Релиз 2.0.0 для Yii второй и последний. Дальнейшая разработка [будет проводиться на Yii2](https://github.com/wartur/yii2-treemp)

Абстракт
--------
Расширение для работы с деревом в реляционной базе данных.
Алгоритм материализованного пути. Алгоритм ускоряет работу с деревом на таких
операциях как выборка ветки, построение дерева или части дерева.
Благодаря алгоритму материализованного пути ускоряется скорость вставки
в произвольное место таблицы. Для дополнительной сортировки веток
на каждом из уровне требуется использовать дополнительный алгоритм.
В качестве примера берите https://github.com/wartur/yii-sorter, пожалуй он будет
самым быстрым из ныне существующих. Кстати в Yii2 планирую скрестить 2
этих расширения между собой и получить готовый продукт с поддержкой пользовательской
сортировки веток.

ВАЖНО: все операции с использованием данного расширения ДОЛЖНЫ производиться через
транзакции(ISOLATION LEVEL SERIALIZABLE)/блокировки. В противном случае
есть вероятность разрушения базы данных.
Все действия данного расширения включают в себя транзакции, в случаях когда таблица
не поддерживает транзакции требуется пользоваться блокировкой таблицы

Подключение расширения к проекту
--------------------------------
1) [Скачайте новейший релиз](https://github.com/wartur/yii-treemp/releases)

2) Распакуйте yii-treemp в директории ext.wartur.yii-treemp

3) Добавьте новый алиас пути в начало конфигурационного файла (по умолчанию: config/main.php)
```php
Yii::setPathOfAlias('treemp', 'protected/extensions/wartur/yii-treemp');
```

4) Добавьте поведение в модель в которой требуется поддержка работы с деревьями.
Минимальная конфигурация:
```php
public function behaviors() {
	return array_merge(parent::behaviors(), array(
		'TreempActiveRecordBehavior' => array(
			'class' => 'treemp.behaviors.TreempActiveRecordBehavior',
		)
	));
}
```

5) Проверьте, что ваша модель удовлетворяет схеме, указанной в [treemp.tests.env.schema](https://github.com/wartur/yii-treemp/blob/master/tests/env/schema/treetest.sql).
Помните для работы поведения требуется поле VARCHAR(255) path с УНИКАЛЬНЫМ ключом. Подробнее
вы можете прочитать в [API reference поведения](https://github.com/wartur/yii-treemp/blob/master/behaviors/TreempActiveRecordBehavior.php)

Работа с готовыми виджетами
---------------------------
К расширению поставляется базовый набор виджетов.
Используя текущее API, вы можете написать свой виджет, остальное за вас
сделает поведение. Вам не нужно знать, как оно сработает на низком уровне, важно
понимать, что оно сработает очень быстро и правильно.

1) Виджет и поведение для составления дерева
============== TODO ==============

2) Виджет и поведение для присоеденинения дерева к конкретной модели
============== TODO ==============

3) Виджет и поведение для присоединения нескольких веток дерева к конкретной модели через промежуточную таблицу
	- не забыть сделать дополнительный параметр (обновить все записи, даже которые небыли изменены)
============== TODO ==============

4) Виджет хлебных крошек
============== TODO ==============
